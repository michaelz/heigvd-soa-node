<script type="text/javascript" charset="utf-8">
    {{> uilogic}}
    var token = localStorage.getItem('woa-token');
    // send the authorization token. Doesn't work because we use handlebars and backend routes, not ajax calls to load our pages.
    /*$( document ).ajaxSend(function( event, jqxhr, settings ) {
        jqxhr.setRequestHeader("Authorization", token);
        console.log('token: '+token);
    });*/
    console.log('token: '+token);
    webix.ui({"id": "main"});
    webix.ajax()
        .headers({
            'Authorization': token
        })
        .get("/api/ui/{{pageid}}", function(text, data, XmlHttpRequest){
            if (data.json().status == 'error') {
                window.location.replace('/login?dest={{pageid}}');
            }
            webix.ui(data.json(), $$("main"));

            {{#if has_partial}}
            {{> (lookup . 'pageid') }}
            {{/if}}
    });
</script>
